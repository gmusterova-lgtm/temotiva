<!-- Hero -->
<section id="inicio" class="section hero reveal" aria-labelledby="hero-title">
  <div class="container u-col u-gap">
    <h1 id="hero-title">Innovación en bienestar digital</h1>
    <p>Psicología y tecnología, para cuidarte en menos de cinco minutos al día.</p>
    <div class="cta-row">
      <a href="/particular.html" class="btn" data-gtag="cta_hero_particular" rel="next">Soy particular</a>
      <a href="/organizacion.html" class="btn secondary" data-gtag="cta_hero_org" rel="next">Soy organización</a>
    </div>
  </div>
</section>

<!-- App próximamente, sin formulario -->
<section id="lanzamiento" class="section reveal" aria-labelledby="app-title">
  <div class="container app-cta">
    <h2 id="app-title" style="font-size:var(--h2); margin:0 0 .6rem;">Muy pronto, TEMOTIVA como app</h2>
    <p class="frase" style="margin-top:.2rem;">Recordatorios suaves, uso sin conexión, privacidad por diseño. Tu bienestar, a mano.</p>
  </div>
</section>

<!-- Valor -->
<section id="valor" class="section reveal" aria-labelledby="valor-title">
  <div class="container">
    <h2 id="valor-title" style="font-size:var(--h2); margin:0 0 .6rem;">Qué te aporta TEMOTIVA</h2>
    <div class="grid" role="list">
      <article class="card" role="listitem">
        <h3>Autocuidado diario</h3>
        <p>Microacciones que sí caben en tu rutina.</p>
      </article>
      <article class="card" role="listitem">
        <h3>Psicología práctica</h3>
        <p>Herramientas basadas en evidencia, explicadas en claro.</p>
      </article>
      <article class="card" role="listitem">
        <h3>Bienestar sin ruido</h3>
        <p>Menos pantalla, más calma.</p>
      </article>
      <article class="card" role="listitem">
        <h3>Privacidad por diseño</h3>
        <p>Tus datos, bajo tu control.</p>
      </article>
    </div>
  </div>
</section>

<!-- Cómo funciona (Producto) -->
<section id="producto" class="section alt reveal" aria-labelledby="product-title">
  <div class="container">
    <h2 id="product-title" style="font-size:var(--h2); margin:0 0 .6rem;">Cómo funciona</h2>
    <p style="max-width:70ch;">Tres pasos simples para ganar calma y claridad.</p>

    <div class="grid" role="list">
      <article class="card" role="listitem">
        <h3>1. Explora tus emociones</h3>
        <p>Dos o tres preguntas al día. Detecta patrones reales, sin agobio.</p>
      </article>
      <article class="card" role="listitem">
        <h3>2. Practica ejercicios breves</h3>
        <p>Respiración, reencuadre y pausa activa. Eficaces, sencillos, repetibles.</p>
      </article>
      <article class="card" role="listitem">
        <h3>3. Observa tu evolución</h3>
        <p>Gráficas simples y metas amables que te motivan.</p>
      </article>
    </div>

    <!-- Eliminado el bloque de imagen inferior que no cargaba -->
  </div>
</section>

<!-- Reseñas -->
<section id="resenas" class="section reviews reveal" aria-labelledby="reviews-title">
  <div class="container">
    <h2 id="reviews-title" style="font-size:var(--h2); margin:0 0 .6rem;">Reseñas</h2>
    <p class="frase" style="margin-top:.2rem;">Personas reales, cambios sostenibles.</p>
    <div class="grid">
      <article class="review" itemscope itemtype="https://schema.org/Review">
        <blockquote itemprop="reviewBody">Con cinco minutos al día bajo revoluciones y duermo mejor.</blockquote>
        <div class="who"><span itemprop="author" itemscope itemtype="https://schema.org/Person"><span itemprop="name">María</span></span></div>
      </article>
      <article class="review" itemscope itemtype="https://schema.org/Review">
        <blockquote itemprop="reviewBody">Entiendo mis picos de ansiedad y los prevengo.</blockquote>
        <div class="who"><span itemprop="author" itemscope itemtype="https://schema.org/Person"><span itemprop="name">Rubén</span></span></div>
      </article>
    </div>
  </div>
</section>

<!-- Misión -->
<section id="mision" class="section reveal" aria-labelledby="mission-title">
  <div class="container">
    <h2 id="mission-title" style="font-size:var(--h2); margin:0 0 .6rem;">Nuestra misión</h2>
    <p style="max-width:70ch;">Creemos que el bienestar emocional no debería ser un lujo, sino un hábito accesible, claro y amable para todos.</p>
  </div>
</section>

<!-- CTA final -->
<section id="cta-final" class="section reveal u-center" aria-labelledby="cta-final-title">
  <div class="container u-col u-gap" style="align-items:center; text-align:center;">
    <h2 id="cta-final-title" style="font-size:var(--h2); margin:0 0 .6rem;">Empieza hoy</h2>
    <p class="frase">Da el primer paso, es más pequeño de lo que crees.</p>
    <div class="cta-row">
      <a href="#valor" class="btn" data-gtag="cta_final_explora">Explora tu bienestar</a>
      <a href="/blog/" class="btn secondary" data-gtag="cta_final_blog">Leer el blog</a>
    </div>
  </div>
</section>

<!-- SPLIT HERE -->
<!-- Contacto -->
<section id="contacto" class="section alt reveal" aria-labelledby="contact-title">
  <div class="container">
    <h2 id="contact-title" style="font-size:var(--h2); margin:0 0 .6rem;">Contacto</h2>

    <form id="contactForm" class="form form-pro" novalidate>
      <input type="hidden" name="_subject" value="Nuevo mensaje desde TEMOTIVA">
      <input type="hidden" name="_language" value="es">

      <div class="row">
        <div>
          <label for="cf-nombre">Nombre</label>
          <input id="cf-nombre" type="text" name="nombre" placeholder="Tu nombre" required autocomplete="name">
          <div class="error" id="cf-nombre-error">Indica tu nombre.</div>
        </div>
        <div>
          <label for="cf-email">Correo</label>
          <input id="cf-email" type="email" name="email" placeholder="tu@email.com" required autocomplete="email" inputmode="email">
          <div class="error" id="cf-email-error">Introduce un correo válido.</div>
        </div>
      </div>

      <div class="u-mt">
        <label for="cf-msg">Mensaje</label>
        <textarea id="cf-msg" name="mensaje" rows="4" placeholder="¿Cómo podemos ayudarte?" required></textarea>
        <div class="error" id="cf-msg-error">Cuéntanos brevemente tu consulta.</div>
      </div>

      <!-- Consentimiento alineado bajo el bloque -->
      <div class="u-mt">
        <label class="checkline" for="cf-consent">
          <input id="cf-consent" type="checkbox" name="consent" required>
          <span>Acepto la <a href="/privacidad.html">política de privacidad</a> y el tratamiento de mis datos para responder a mi consulta.</span>
        </label>
      </div>

      <input type="text" name="_gotcha" class="u-hidden" aria-hidden="true" autocomplete="off">

      <div class="u-flex u-gap-s u-mt">
        <button type="submit" class="btn" id="cf-submit" disabled>Enviar</button>
        <small class="hint">Respondemos lo antes posible, conservarás copia en tu correo.</small>
      </div>
    </form>

    <p id="formMsg" class="form-msg u-hidden" style="color:#1a7f37; margin-top:1rem;">
      Gracias, te contactaremos pronto. Si lo deseas, puedes enviar un mensaje a
      <a href="mailto:info@temotiva.com">info@temotiva.com</a>, estaremos encantados de atenderte.
    </p>
  </div>
</section>

<!-- Footer (sin tocar) -->
<footer class="site-footer" role="contentinfo">
  <div class="container" style="display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;">
    <p style="margin:0;">© TEMOTIVA desde 2024</p>
    <div class="u-flex u-gap-s" style="align-items:center;">
      <a href="/privacidad.html">Política de privacidad</a>
      <a href="/cookies.html">Política de cookies</a>
      <a href="/aviso-legal.html">Aviso legal</a>
      <a href="#inicio" class="back-top" style="color:var(--ink-soft);">Volver arriba ↑</a>
    </div>
  </div>
</footer>
</main>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
<script>
  window.addEventListener("load", () => {
    try {
      const SUPABASE_URL = "https://ejhzxwnhqvcqjqxnuvya.supabase.co";
      const SUPABASE_ANON_KEY = "sb_publishable_8nz_638F1vO2JbkFw9DHSw_AxB179qA";
      const supabase = window.supabase?.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      console.log("Conectado a Supabase", !!supabase);
    } catch(e){ console.warn("Supabase no disponible", e); }
  });
</script>

<!-- JS base -->
<script src="/script.js" defer></script>

<!-- UI, accesibilidad, PWA y mejoras -->
<script>
  document.documentElement.classList.add('js-ready');
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  /* Header sombra y nav activa por sección */
  const siteHeader = $("#siteHeader");
  const sections = ["mision","producto","resenas","lanzamiento","contacto"].map(id => document.getElementById(id));
  const navLinks = $$("#mainNav a");
  function setActive(hash){
    navLinks.forEach(a => {
      const is = a.getAttribute("href") === hash || a.getAttribute("href") === location.pathname + hash;
      a.classList.toggle("active", is);
      if(is) a.setAttribute("aria-current","page"); else a.removeAttribute("aria-current");
    });
  }
  const onScrollHeader = () => {
    siteHeader.classList.toggle("is-scrolled", (window.scrollY || window.pageYOffset) > 8);
  };
  onScrollHeader();
  document.addEventListener("scroll", onScrollHeader, { passive: true });
  if ("IntersectionObserver" in window){
    const ioNav = new IntersectionObserver(entries => {
      entries.forEach(e => { if (e.isIntersecting){ setActive(`#${e.target.id}`); } });
    }, { threshold:.5 });
    sections.forEach(s => s && ioNav.observe(s));
  }

  /* Panel lateral accesible */
  const body = document.body;
  const sidebar = $("#sidePanel");
  const overlay = $("#overlay");
  const menuBtn = $("#menuBtn");
  let lastFocus = null;
  function trapFocus(e){
    const focusables = sidebar.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if (!focusables.length) return;
    const first = focusables[0], last = focusables[focusables.length - 1];
    if (e.key === "Tab"){
      if (e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
    }
  }
  function openSidebar(){
    lastFocus = document.activeElement;
    sidebar.classList.add("is-open");
    sidebar.setAttribute("aria-hidden","false");
    overlay.classList.add("show");
    body.style.overflow = "hidden";
    menuBtn?.setAttribute("aria-expanded","true");
    const first = sidebar.querySelector("a, button, input, select, textarea");
    first && first.focus();
    sidebar.addEventListener("keydown", trapFocus);
  }
  function closeSidebar(){
    sidebar.classList.remove("is-open");
    sidebar.setAttribute("aria-hidden","true");
    overlay.classList.remove("show");
    body.style.overflow = "";
    menuBtn?.setAttribute("aria-expanded","false");
    sidebar.removeEventListener("keydown", trapFocus);
    lastFocus && lastFocus.focus();
  }
  menuBtn?.addEventListener("click", () => sidebar.classList.contains("is-open") ? closeSidebar() : openSidebar());
  overlay?.addEventListener("click", closeSidebar);
  document.addEventListener("keydown", e => { if(e.key === "Escape") closeSidebar(); });

  /* Tema: auto -> dark -> light con theme-color */
  const metaTheme = $("#meta-theme");
  const THEME_KEY = "temotiva-theme-mode";
  const mDark = window.matchMedia("(prefers-color-scheme: dark)");
  function applyTheme(mode){
    const root = document.documentElement;
    if(mode === "dark"){
      root.setAttribute("data-theme", "dark");
      metaTheme?.setAttribute("content", "#0f1115");
    } else if(mode === "light"){
      root.setAttribute("data-theme", "light");
      metaTheme?.setAttribute("content", "#F7F7F7");
    } else {
      root.setAttribute("data-theme", mDark.matches ? "dark" : "light");
      metaTheme?.setAttribute("content", mDark.matches ? "#0f1115" : "#F7F7F7");
    }
    localStorage.setItem(THEME_KEY, mode);
    $("#themeBtn")?.setAttribute("aria-pressed", mode === "dark" ? "true" : "false");
  }
  mDark.addEventListener("change", () => { if((localStorage.getItem(THEME_KEY) || "auto") === "auto") applyTheme("auto"); });
  $("#themeBtn")?.addEventListener("click", () => {
    const cur = localStorage.getItem(THEME_KEY) || "auto";
    const next = cur === "auto" ? "dark" : cur === "dark" ? "light" : "auto";
    applyTheme(next);
  });
  applyTheme(localStorage.getItem("temotiva-theme-mode") || "auto");

  /* i18n mínimo (no tocamos tus claves extendidas previas) */
  const i18n = {
    es: { "nav.home":"Inicio","nav.mission":"Misión","nav.product":"Producto","nav.contact":"Contacto" },
    en: { "nav.home":"Home","nav.mission":"Mission","nav.product":"Product","nav.contact":"Contact" }
  };
  function applyLang(lang){
    const dict = i18n[lang] || i18n.es;
    document.documentElement.setAttribute("lang", lang === "en" ? "en" : "es");
    $$("#mainNav a").forEach(el => {
      const k = el.getAttribute("data-i18n");
      if(k && dict[k]) el.textContent = dict[k];
    });
    localStorage.setItem("temotiva-lang", lang);
  }
  applyLang(localStorage.getItem("temotiva-lang") || "es");
  $("#langBtn")?.addEventListener("click", ()=>{
    const next = (localStorage.getItem("temotiva-lang") || "es") === "es" ? "en" : "es";
    applyLang(next);
  });

  /* Reveal con IO */
  (function(){
    const items = $$(".reveal");
    if(!("IntersectionObserver" in window)){ items.forEach(el => el.classList.add("visible")); return; }
    const io = new IntersectionObserver(entries => {
      entries.forEach(e => { if(e.isIntersecting){ e.target.classList.add("visible"); io.unobserve(e.target); } });
    }, { threshold: .12, rootMargin: "0px 0px -8% 0px" });
    items.forEach(el => io.observe(el));
  })();

  /* Service Worker */
  if("serviceWorker" in navigator){
    window.addEventListener("load", ()=>{
      navigator.serviceWorker.register("/pwabuilder-sw.js", { scope: "/" })
        .then(reg => console.log("Service Worker activo:", reg.scope))
        .catch(err => console.error("Fallo al registrar el SW:", err));
    });
  }

  /* Frase del día (si hay botón en la página) */
  const frases = [
    "Respira. Un paso a la vez.",
    "Tu progreso importa, aunque sea pequeño.",
    "Date permiso para descansar.",
    "Lo que no mides, no mejoras."
  ];
  $("#nuevaFraseBtn")?.addEventListener("click", ()=>{
    const el = $("#fraseTexto");
    el.textContent = frases[Math.floor(Math.random()*frases.length)];
  });

  /* Contacto: validación y envío con reintento */
  (function(){
    const form = document.getElementById('contactForm');
    const okMsg = document.getElementById('formMsg');
    if(!form) return;
    const nombre = document.getElementById('cf-nombre');
    const email = document.getElementById('cf-email');
    const msg = document.getElementById('cf-msg');
    const eNombre = document.getElementById('cf-nombre-error');
    const eEmail = document.getElementById('cf-email-error');
    const eMsg = document.getElementById('cf-msg-error');
    const btn = document.getElementById('cf-submit');
    const consent = document.getElementById('cf-consent');

    function clearErr(i, e){ i.addEventListener('input', ()=>{ i.setCustomValidity(''); e.style.display='none'; }); }
    clearErr(nombre, eNombre); clearErr(email, eEmail); clearErr(msg, eMsg);

    function toggle(){ btn.disabled = !consent.checked; }
    consent?.addEventListener('change', toggle); toggle();

    async function postWithRetry(url, body){
      const ctrl = new AbortController(); const t = setTimeout(()=>ctrl.abort(), 8000);
      try{ const r = await fetch(url,{method:'POST',headers:{Accept:'application/json'},body,signal:ctrl.signal}); clearTimeout(t); if(r.ok) return true; }catch{}
      try{ const r2 = await fetch(url,{method:'POST',headers:{Accept:'application/json'},body}); return r2.ok; }catch{ return false; }
    }

    form.addEventListener('submit', async e=>{
      e.preventDefault();

      let valid = true;
      if(!nombre.value.trim()){ valid=false; nombre.setCustomValidity('Requerido'); eNombre.style.display='block'; }
      if(!email.checkValidity()){ valid=false; email.setCustomValidity('Correo no válido'); eEmail.style.display='block'; }
      if(!msg.value.trim()){ valid=false; msg.setCustomValidity('Requerido'); eMsg.style.display='block'; }
      if(!valid){ [nombre,email,msg].forEach(el=>el.reportValidity()); return; }

      btn.disabled = true;
      const ok = await postWithRetry("https://formspree.io/f/xnnobrvn", new FormData(form));
      btn.disabled = false;

      if(ok){ form.reset(); okMsg?.classList.remove('u-hidden'); }
      else { alert("No se pudo enviar, intenta de nuevo más tarde."); }
    });
  })();

  /* PWA install banner (sin cambios) */
  const INSTALL_KEY = "temotiva-install-dismissed";
  const VISITS_KEY = "temotiva-visit-count";
  let deferredPrompt = null;
  try { const v = parseInt(localStorage.getItem(VISITS_KEY) || "0", 10) + 1; localStorage.setItem(VISITS_KEY, String(v)); } catch {}
  const installBtn = $("#installBtn");
  const banner = $("#pwaBanner");
  const installNow = $("#pwaInstallNow");
  const installLater = $("#pwaInstallLater");

  window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn && (installBtn.hidden = false);
    const dismissed = localStorage.getItem(INSTALL_KEY) === "1";
    const visits = parseInt(localStorage.getItem(VISITS_KEY) || "0", 10);
    if (!dismissed && visits >= 3 && banner) banner.classList.add("show");
  });
  async function promptInstall(){
    try{
      installBtn && (installBtn.hidden = true);
      await deferredPrompt.prompt();
      const res = await deferredPrompt.userChoice;
      if (!res || res.outcome !== "accepted") banner?.classList.remove("show");
    }catch{}
    deferredPrompt = null;
  }
  installBtn?.addEventListener("click", ()=> deferredPrompt && promptInstall());
  installNow?.addEventListener("click", ()=> deferredPrompt ? promptInstall() : banner?.classList.remove("show"));
  installLater?.addEventListener("click", (ev)=> { ev.preventDefault(); localStorage.setItem(INSTALL_KEY,"1"); banner?.classList.remove("show"); });

  window.addEventListener("appinstalled", () => {
    try { localStorage.setItem(INSTALL_KEY, "1"); } catch {}
    banner?.classList.remove("show");
    installBtn && (installBtn.hidden = true);
    console.log("TEMOTIVA instalada");
  });

  const isStandalone = window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone;
  if (isStandalone) { installBtn?.setAttribute("hidden","true"); banner?.classList.remove("show"); }

  /* GA para CTAs clave */
  document.querySelectorAll('[data-gtag]').forEach(b=>b.addEventListener('click',()=>gtag('event', b.dataset.gtag)));

  /* Volver arriba con reduce motion */
  document.querySelector('.back-top')?.addEventListener('click', e=>{
    e.preventDefault();
    const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
    window.scrollTo({ top: 0, behavior: prefersReduced ? 'auto' : 'smooth' });
  });
</script>

<!-- Banner de instalación PWA -->
<div id="pwaBanner" class="pwa-install" role="dialog" aria-live="polite" aria-label="Instalar TEMOTIVA">
  <div class="row">
    <img src="/icon-192.png" alt="" width="28" height="28" style="border-radius:6px">
    <div class="msg">Instala TEMOTIVA para un acceso rápido y uso sin conexión.</div>
    <div class="actions">
      <button id="pwaInstallNow" class="btn" type="button">Instalar</button>
      <button id="pwaInstallLater" class="btn secondary" type="button">Más tarde</button>
    </div>
  </div>
</div>

<!-- Eventos GA del banner -->
<script>
  document.getElementById("pwaInstallNow")?.addEventListener("click", function() {
    gtag('event', 'click_instalar', { 'event_category': 'PWA', 'event_label': 'Botón Instalar TEMOTIVA' });
  });
  document.getElementById("pwaInstallLater")?.addEventListener("click", function() {
    gtag('event', 'click_instalar_mas_tarde', { 'event_category': 'PWA', 'event_label': 'Botón Más tarde' });
  });
</script>
</body>
</html>
